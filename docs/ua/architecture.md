# Огляд архітектури

Розуміння архітектури екосистеми Concept-Labs.

## Архітектура системи

```
            ┌─────────────┐
Request  →  │  Middleware │  (конвеєр: ...безпека... → ...сесія... → ...маршрутизатор... →... flusher)
            └──────┬──────┘
                   │        PSR‑15
                   ▼
            ┌─────────────┐
            │   Router    │  → обробник/контролер
            └──────┬──────┘
                   ▼
            ┌─────────────┐
            | ?Middleware?|
            └──────┬──────┘
                   │
                   ▼
     ┌─────────────┐┌─────────────┐
     │   Raw/API   ││   Views     │
     └─────────────┘└─────────────┘

Події: PSR‑14 диспетчер + EventBus; раннє завантаження через EventBusMiddleware.
Конфігурація: JSON DSL (імпорти, env, заповнювачі) + DotArray/DotQuery.
DI:    Singularity (переваги інтерфейсів оголошені в concept.json).
БД:    DBC (драйвери PDO) + DBAL (діалекти, конструктори DML, вирази).
```

## Основні компоненти

### Шар конфігурації
- **JSON DSL** з імпортами, змінними оточення та підстановкою заповнювачів
- **DotArray/DotQuery** для інтуїтивного вкладеного доступу
- **Конфігурація на рівні пакета** через `concept.json`

### Впровадження залежностей (Singularity)
- **PSR-11 сумісний** контейнер
- **Переваги інтерфейсів** для гнучкого зв'язування сервісів
- **Конфігурація DI на рівні пакета** для модульної архітектури
- **Множинні патерни життєвого циклу** (Transient, Shared, Weak, Prototype)

### HTTP стек
- **PSR-7/15/17** для HTTP повідомлень, middleware та фабрик
- **Конвеєр middleware на основі пріоритетів** з налаштовуваними смугами
- **Маршрутизатор** з гнучкими можливостями маршрутизації
- **Смуги middleware** для організованої обробки запитів

### Система подій
- **PSR-14 диспетчер подій** для стандартизованої обробки подій
- **EventBus** для координації подій всього додатка
- **Слухачі на основі конфігурації** для декларативної обробки подій

### Шар бази даних
- **DBC** (Database Connectivity) для з'єднань на основі PDO
- **DBAL** (Database Abstraction Layer) для запитів, специфічних для діалекту
- **Плавні конструктори запитів** для типобезпечних операцій з базою даних
- **Підтримка PostgreSQL, MySQL/MariaDB** з адаптерами діалектів

## Принципи дизайну

### PSR стандарти на першому місці
Всі компоненти дотримуються стандартів PHP-FIG для максимальної взаємодії:
- PSR-3 (Логування), PSR-7 (HTTP повідомлення), PSR-11 (Контейнер)
- PSR-14 (Диспетчер подій), PSR-15 (HTTP обробники)
- PSR-17 (HTTP фабрики), PSR-18 (HTTP клієнт)

### Модульний та композиційний
- Кожен пакет самостійний зі своїм власним `concept.json`
- Пакети оголошують свої залежності та переваги
- Додатки вибирають, які пакети включити

### Готовий до production
- Створено для довготривалих процесів (RoadRunner, Swoole)
- Конвеєр middleware з низькими накладними витратами
- Чіткі межі помилок та обробка винятків
- Ефективні з точки зору пам'яті патерни дизайну

### Явна конфігурація
- Поведінка контролюється читабельними JSON конфігураціями
- Ніякої прихованої магії або неявних конвенцій
- Конфігурацію можна контролювати версіями та порівнювати

## Наступні кроки

- [DSL конфігурації](./configuration.md) - Вивчіть систему конфігурації
- [Впровадження залежностей](./dependency-injection.md) - Зрозумійте контейнер DI
- [HTTP стек](./http-stack.md) - Будуйте HTTP додатки
- [Шар бази даних](./database.md) - Працюйте з базами даних
